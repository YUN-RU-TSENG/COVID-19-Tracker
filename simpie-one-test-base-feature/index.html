<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å–®ç´”ç”¨ vue.js cdn åšçš„ç°¡å–®æ¸¬è©¦è‰ç¨¿ï¼Œå¾ˆéš¨æ„</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
      integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css"
    />
    <style>
      .slide-fade-enter-active {
        transition: all 0.8s ease;
      }
      .slide-fade-leave-active {
        transition: all 0.8s cubic-bezier(1, 0.5, 0.8, 1);
      }
      .slide-fade-enter, .slide-fade-leave-to {
        transform: translateX(10px);
        opacity: 0;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <nav class="navbar navbar-expand navbar-light bg-light mb-4">
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <form class="form-inline" @submit.prevent="setFiltersWord">
            <input
              class="form-control mr-sm-2"
              type="search"
              placeholder="Search åœ‹å®¶åç¨±"
              aria-label="Search"
              @input="setFiltersWordInput"
            />
            <button class="btn btn-outline-success" type="submit">
              Search
            </button>
          </form>
          <div
            class="form-check form-check-inline ml-3"
            v-for="branch of branches"
          >
            <input
              class="form-check-input"
              type="radio"
              name="inlineRadioOptions"
              :id="branch.name"
              value="option1"
              :value="branch.name"
              :checked="branch.name === currentBranch"
              v-model="currentBranch"
            />
            <label class="form-check-label" :for="branch.name"
              >{{ branch.text }}</label
            >
          </div>
        </div>
      </nav>
      <div class="container">
        <transition name="slide-fade" appear>
          <div class="alert alert-warning" role="alert" v-if="isLoadFinish">
            æˆªè‡³ä»Šæ—¥ä¸–ç•Œå·²æœ‰
            <strong v-text="">
              {{ totalCases | pertThousandDisplay }}
            </strong>
            äººæŸ“ç–«ã€‚å·²æœ‰
            <strong> {{ totalDeaths | pertThousandDisplay }} </strong>äººæŸ“ç–«èº«äº¡ã€‚
          </div>
        </transition>
        <transition name="slide-fade" appear>
          <p v-if="isLoadFinish">
            <small
              >å…±æœ‰ {{ COVID_19_DatasFilterTotalCases ? `${COVID_19_DatasFilterTotalCases}
              ç­†æœå°‹çµæœ` : `0 åŒ¹é…çµæœï¼Œè«‹é‡æ–°è¼¸å…¥åœ‹å®¶åç¨±`}}</small
            >
          </p>
        </transition>
        <div class="row">
          <div
            class="col-lg-4 col-md-6"
            v-for="(COVID_19_Data, index) of COVID_19_DatasFilterRank"
            :key="COVID_19_Data.country"
          >
            <transition name="slide-fade" appear>
              <div class="card mb-4 border-success">
                <h5 class="card-header">
                  <strong>{{ index | DisplayArrayIndexNumber }}</strong>{{
                  COVID_19_Data.country }}
                </h5>
                <div class="card-body">
                  <p class="card-text m-0">
                    ä»Šæ—¥ç¢ºè¨ºäººæ•¸: {{ COVID_19_Data.todayCases | pertThousandDisplay }}
                  </p>
                  <p class="card-text m-0">
                    ä»Šæ—¥é€ä¸–äººæ•¸: {{ COVID_19_Data.todayDeaths | pertThousandDisplay
                    }}
                    <span class="badge badge-pill badge-danger">New</span>
                  </p>
                  <p class="card-text m-0">
                    é€ä¸–äººæ•¸: {{ COVID_19_Data.deaths | pertThousandDisplay }}
                    <span class="badge badge-pill badge-warning">Total</span>
                  </p>
                  <p class="card-text m-0">
                    ç¢ºè¨ºäººæ•¸: {{ COVID_19_Data.cases | pertThousandDisplay }}
                  </p>
                  <p class="card-text m-0">
                    åœ‹å®¶ç¸½äººå£: {{ COVID_19_Data.population | pertThousandDisplay }}
                  </p>
                  <p class="card-text m-0">
                    æœ€å¾Œæ›´æ–°æ™‚é–“: {{ COVID_19_Data.updated | timeFormateDisplay }}
                  </p>
                </div>
              </div>
            </transition>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.11/vue.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
    <script>
      const apiURL = "https://corona.lmao.ninja/v2/countries?yesterday&sort",
            data = {
              COVID_19_Datas: [],
              filtersWord: "",
              branches: [
                {
                  name: "deaths",
                  text: "æ­»äº¡äººæ•¸æ’åº",
                },
                {
                  name: "cases",
                  text: "ç”Ÿç—…äººæ•¸æ’åº",
                },
                {
                  name: "word",
                  text: "åœ‹å®¶å­—æ¯æ’åº",
                },
              ],
              currentBranch: "deaths",
              isLoadFinish: false,
            };

      const vm = new Vue({
        el: "#app",
        data,
        created() {
          NProgress.start();
          this.fetchAPIData().then(() => {
            NProgress.done();
            this.isLoadFinish = true;
          });
        },
        computed: {
          totalCases() {
            return this.COVID_19_Datas.reduce((acc, cur) =>  acc + parseInt(cur.cases), 0);
          },
          totalDeaths() {
            return this.COVID_19_Datas.reduce((acc, cur) =>  acc + parseInt(cur.deaths), 0);
          },
          COVID_19_DatasFilter() {
            if (!this.filtersWord) return this.COVID_19_Datas;
            else
              return this.COVID_19_Datas.filter((data) => {
                const regExp = new RegExp(this.filtersWord, "i");
                if (regExp.test(data.country)) return data;
              });
          },
          COVID_19_DatasFilterTotalCases() {
            return this.COVID_19_DatasFilter.length;
          },
          COVID_19_DatasTotalCases() {
            return this.COVID_19_Datas.length;
          },
          COVID_19_DatasFilterRank() {
            switch (true) {
              case this.currentBranch === "word":
                    return this.COVID_19_DatasFilter.sort((aft, bef) => {
                      const aftWord = aft.country.slice(0,1).toLowerCase().charCodeAt(),
                            befWord = bef.country.slice(0,1).toLowerCase().charCodeAt();
                      return aftWord - befWord;
                    })
              case this.currentBranch === "deaths":
              case this.currentBranch === "cases":
                    return this.COVID_19_DatasFilter.sort((aft, bef) => bef[this.currentBranch]-aft[this.currentBranch])
            }
          }
        },
        filters: {
          pertThousandDisplay(number) {
            if (!parseInt(number)) return `ç„¡ ğŸ¨`;
            else
              return parseInt(number).toLocaleString("zh-TW", {
                style: "decimal",
                useGrouping: true,
              });
          },
          DisplayArrayIndexNumber(number) {
            return `${parseInt(number) + 1}. `;
          },
          timeFormateDisplay(time) {
            const currentTime = new Date(),
                  dataTime = new Date(time),
                  passTime = currentTime.getTime() - dataTime.getTime(),
                  countMinuteTime = 1000 * 60;
            return `${Math.ceil(passTime / countMinuteTime)} åˆ†é˜å‰ ğŸ“ƒ`;
          },
        },
        methods: {
          fetchAPIData() {
            return fetch(apiURL)
              .then((response) => response.json())
              .then((data) =>  this.COVID_19_Datas = data)
              .catch((error) => console.error(error));
          },
          setFiltersWord(e) {
            this.filtersWord = e.target.firstElementChild.value;
          },
          setFiltersWordInput(e) {
            this.filtersWord = e.target.value.trim();
          },
          gotoSearch(){

          }
        },
      });
    </script>
  </body>
</html>